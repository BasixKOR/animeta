{% extends "base.html" %}

{% block title %}{{ owner.username }} 사용자 - 애니메타{% endblock %}

{% block nav %}
<h1><a href="{% url user.views.library owner %}">{{ owner.username }} 사용자</a></h1>
{% endblock %}

{% block content %}
<div id="library">
<div id="library-items" class="items-container">
<form id="item-filter-form">
    <div class="items-header">
        <div>
            분류: {{ filter_form.category }}
            {% ifequal owner request.user %}
            <a href="/records/category/">관리</a>
            {% endifequal %}
        </div>
        <div>
            정렬 기준: {{ filter_form.sort_by }}
        </div>
    </div>

    <div class="items">
    {% for key, list in items %}
        <div class="item-group-header">{{ key }}</div>
    {% for item in list %}
        <div class="item item-{{ item.status_type }}">
            <span class="item-title"><a href="{{ item.id }}">{{ item.title }}</a></span>
            <span class="item-status">
            {% if item.status_type == 'watching' %}
                {% if item.status %}{{ item.get_status_display }}{% else %}{{ item.get_status_type_display }}{% endif %}
            {% else %}
                <span class="item-status-type">{{ item.get_status_type_display }}</span>
                {% if item.status %}<span class="item-status-at">@</span> {{ item.get_status_display }}{% endif %}
            {% endif %}
            </span>
        </div>
    {% endfor %}
    {% endfor %}
    </div>

    <div class="items-footer">
    {{ filter_form.status }}
    </div>
</form>
</div>

<div id="library-records" class="records-container">
<div id="library-history-content">
{% for record in records %}
{% include "history.html" with history=record show_work=1 %}
{% endfor %}
</div>
<div id="library-records-content"></div>
</div>
</div>

<script type="text/javascript">
function fixContainerHeight() {
	$('#library-items, #library-records').height($(window).height() - $('#library').position().top - $('#footer').outerHeight() - 5);
}

function returnToAll() {
    $('.item').removeClass('s-selected');
    $('#library-history-content').show();
    $('#library-records-content').hide();
}

$(function() {
	fixContainerHeight();
	$('#item-filter-form').find('input, select').change(function() {
    	$('#item-filter-form').submit();
    });
	$('.item a').click(function(e) { e.preventDefault(); });
	$('.item').click(function() {
    	$('.item').removeClass('s-selected');
    	$(this).addClass('s-selected');
    	$('#library-history-content').hide();
    	$('#library-records-content').html('').load($(this).find('a').attr('href')).show();
    });
});

$(window).bind('resize', fixContainerHeight);
</script>
{% endblock %}
